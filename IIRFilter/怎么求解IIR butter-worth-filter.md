# 求解巴特沃斯IIR滤波器

## 1. 设计目标
巴特沃斯滤波器的核心需求：
- 通带内**最大平坦**（Maximally Flat Passband）
- 单调递减的幅度响应

## 2. 幅度平方响应构造
选择以下形式满足平坦性和单调性：
$$
|H(j\omega)|^2 = \frac{1}{1 + \left(\frac{\omega}{\omega_c}\right)^{2N}}
$$

其中：
- $N$：滤波器阶数
- $\omega_c$：截止频率（-3 dB点）

## 3. 关键特性验证
### (1) 通带平坦性
在$\omega=0$处泰勒展开：
$$
|H(j\omega)|^2 \approx 1 - \left(\frac{\omega}{\omega_c}\right)^{2N} + \mathcal{O}(\omega^{4N})
$$
前$2N-1$阶导数均为零。

### (2) 截止频率点
当$\omega = \omega_c$时：
$$
|H(j\omega_c)|^2 = \frac{1}{2} \quad \Rightarrow \quad 20\log_{10}|H(j\omega_c)| = -3\text{dB}
$$

### (3) 高频衰减
当$\omega \gg \omega_c$时：
$$
|H(j\omega)| \approx \left(\frac{\omega_c}{\omega}\right)^N
$$

## 4. 传递函数推导
将$s=j\omega$代入幅度平方响应：
$$
H(s)H(-s) = \frac{1}{1 + \left(\frac{s}{j\omega_c}\right)^{2N}}
$$

极点位置：
$$
s_k = \omega_c \cdot e^{j\frac{\pi}{2N}(2k + N + 1)}, \quad k=0,1,...,2N-1
$$

## 5. 稳定性保障
选取**左半平面极点**构成传递函数：
$$
H(s) = \frac{\omega_c^N}{\prod_{k=0}^{N-1}(s - s_k)}, \quad \text{Re}(s_k) < 0
$$

# 举个例子

设计一个巴特沃斯滤波器，参数如下：

1. 数字通带截止频率$\omega_p=0.2\pi/sample$
2. 数字阻带截止频率$\omega_s=0.5\pi/sample$
3. 通带最大衰减$\alpha_p=3db$
4. 阻带最大衰减$\alpha_s=40db$
5. 采样间隔$T = 1$

## 1.频率预畸变
将数字频率转换为模拟频率：
$$
\Omega_p = \frac{2}{T} \tan\left(\frac{\omega_p}{2}\right) = 2 \tan(0.1\pi) \approx 0.6498 \text{ rad/s}
$$
$$
\Omega_s = \frac{2}{T} \tan\left(\frac{\omega_s}{2}\right) = 2 \tan(0.25\pi) \approx 2.4142 \text{ rad/s}
$$

## 2. 计算巴特沃斯滤波器阶数

$$
N \geq \frac{\log_{10}[(10^{0.1\alpha_s}-1)/(10^{0.1\alpha_p}-1)]}{2 \log_{10}(\Omega_s/\Omega_p)} = \frac{\log_{10}[(10^{4}-1)/(10^{0.3}-1)]}{2 \log_{10}(2.4142/0.6498)} \approx 4.28
$$
取整数阶数 $N = 5$

## 3. 计算3dB截止频率（可选）

 $$
\Omega_c = \frac{\Omega_p}{(10^{0.1\alpha_p}-1)^{1/(2N)}} = \frac{0.6498}{(10^{0.3}-1)^{1/10}} \approx 0.7032 \text{ rad/s}
$$

## 4. 设计归一化巴特沃斯滤波器

巴特沃斯滤波器的幅度平方响应为：

$$
|H(s)|^2 = H(s)H(-s) = \frac{1}{1 + \left(\frac{s}{j\omega_c}\right)^{2N}}
$$

巴特沃斯滤波器的极点位置公式为：

$$
s_k = \omega_c \cdot e^{j\frac{\pi}{2N}(2k + N + 1)}, \quad k = 0,1,...,2N-1
$$

### 参数说明
| 符号 | 含义 |
|------|------|
| $s_k$ | 第$k$个极点（复数） |
| $\omega_c$ | 截止频率（rad/s） |
| $N$ | 滤波器阶数 |
| $k$ | 极点索引（共$2N$个极点） |


5阶巴特沃斯滤波器的极点（$s_k = \sigma_k + j\Omega_k$）：
$$
s_k = e^{j(\pi + \frac{\pi}{2N} + \frac{k\pi}{N})}, \quad k=0,1,...,4
$$
具体极点位置：
- $s_0 = -0.3090 + j0.9511$
- $s_1 = -0.8090 + j0.5878$
- $s_2 = -1.0000 + j0.0000$
- $s_3 = -0.8090 - j0.5878$
- $s_4 = -0.3090 - j0.9511$


传递函数：
$$
H_a(s) = \frac{1}{(s+1)(s^2 + 0.6180s + 1)(s^2 + 1.6180s + 1)}
$$

### 5. 去归一化（调整截止频率）
将$s \rightarrow s/\Omega_c$：
$$
H_a(s) = \frac{\Omega_c^5}{(s/\Omega_c + 1)((s/\Omega_c)^2 + 0.6180(s/\Omega_c) + 1)((s/\Omega_c)^2 + 1.6180(s/\Omega_c) + 1)}
$$

### 6. 双线性变换
将模拟滤波器转换为数字滤波器：
$$
s = \frac{2}{T}\frac{1-z^{-1}}{1+z^{-1}} = 2\frac{1-z^{-1}}{1+z^{-1}}
$$
代入$H_a(s)$得到$H(z)$

### 7. 最终数字滤波器
经过计算整理后（使用MATLAB辅助）：
$$
H(z) = \frac{b_0 + b_1z^{-1} + \cdots + b_5z^{-5}}{1 + a_1z^{-1} + \cdots + a_5z^{-5}}
$$
其中系数：
- 分子$b_i$: [0.0007, 0.0036, 0.0072, 0.0072, 0.0036, 0.0007]
- 分母$a_i$: [1, -3.1806, 4.8612, -4.1186, 1.9454, -0.4073]


## 极点计算

这里补充一下极点的计算：

1. 归一化（$\omega_c = 1$）巴特沃斯滤波器的极点位置为：
$$
s_k = e^{j\frac{\pi}{2N}(2k + N + 1)}, \quad k = 0,1,...,2N-1
$$
其中：
- $N$为滤波器阶数
- **稳定极点**：选择左半平面极点（$\text{Re}(s_k) < 0$）

### 步骤1：计算所有极点角度
对于$N=5$，共计算$2N=10$个极点角度：

$$
\theta_k = \frac{\pi}{10}(2k + 6), \quad k=0,1,...,9
$$

| $k$ | $\theta_k$ 公式       | 具体角度（弧度） | 角度（度数） | 象限       |
|-----|----------------------|------------------|--------------|------------|
| 0   | $\frac{\pi}{10}(6)$  | $0.6\pi$         | 108°         | 第二象限   |
| 1   | $\frac{\pi}{10}(8)$  | $0.8\pi$         | 144°         | 第二象限   |
| 2   | $\frac{\pi}{10}(10)$ | $\pi$            | 180°         | 负实轴     |
| 3   | $\frac{\pi}{10}(12)$ | $1.2\pi$         | 216°         | 第三象限   |
| 4   | $\frac{\pi}{10}(14)$ | $1.4\pi$         | 252°         | 第三象限   |
| 5   | $\frac{\pi}{10}(16)$ | $1.6\pi$         | 288°         | 第四象限   |
| 6   | $\frac{\pi}{10}(18)$ | $1.8\pi$         | 324°         | 第四象限   |
| 7   | $\frac{\pi}{10}(20)$ | $2\pi$           | 360°         | 正实轴     |
| 8   | $\frac{\pi}{10}(22)$ | $2.2\pi$         | 396°         | 第一象限   |
| 9   | $\frac{\pi}{10}(24)$ | $2.4\pi$         | 432°         | 第二象限   |

### 步骤2：筛选稳定极点（左半平面）
选择$\frac{\pi}{2} < \theta_k < \frac{3\pi}{2}$的极点：
- $k=2$: $\pi$（负实轴）
- $k=3$: $1.2\pi$（第三象限）
- $k=4$: $1.4\pi$（第三象限）
- $k=5$: $1.6\pi$（第四象限）
- $k=6$: $1.8\pi$（第四象限）

### 步骤3：计算极点坐标
极点在单位圆上，坐标为$s_k = \cos\theta_k + j\sin\theta_k$：

| $k$ | $\theta_k$ | 极点$s_k$                  | 实部       | 虚部       |
|-----|------------|----------------------------|------------|------------|
| 2   | $\pi$      | $-1 + j0$                  | $-1.0000$  | $0.0000$   |
| 3   | $1.2\pi$   | $-0.3090 - j0.9511$        | $-0.3090$  | $-0.9511$  |
| 4   | $1.4\pi$   | $-0.8090 - j0.5878$        | $-0.8090$  | $-0.5878$  |
| 5   | $1.6\pi$   | $-0.8090 + j0.5878$        | $-0.8090$  | $+0.5878$  |
| 6   | $1.8\pi$   | $-0.3090 + j0.9511$        | $-0.3090$  | $+0.9511$  |

**计算示例**（$k=3$）：
$$
s_3 = e^{j1.2\pi} = \cos(216^\circ) + j\sin(216^\circ) \approx -0.3090 - j0.9511
$$

## 3. 极点分布图
```matlab
% MATLAB绘制极点图
theta = [pi, 1.2*pi, 1.4*pi, 1.6*pi, 1.8*pi];
s = exp(1j*theta);
plot(real(s), imag(s), 'rx', 'MarkerSize', 10);
hold on;
rectangle('Position', [-1,-1,2,2], 'Curvature', [1,1]);
axis equal; grid on;
xlabel('实部'); ylabel('虚部');
title('5阶巴特沃斯滤波器极点分布');