# GTCRN整体架构概览

GTCRN是个U-Net风格的编码器-解码器结构，用于实时语音降噪。

## 数据流

```
输入频谱 (513 bins)
    ↓
ERB变换 (513 → 219)
    ↓
编码器 (下采样 + GTConv×6)
    ↓
DPGRNN ×2 (双路径GRU)
    ↓
解码器 (GTConv×6 + 上采样)
    ↓
ERB逆变换 (219 → 513)
    ↓
输出 (Complex Ratio Mask)
```

513个线性频点压缩到219个ERB频带，低频保留更多细节，高频合并。这样既减少计算量，又符合人耳听觉特性。

## 核心模块

### GTConvLite

编码器和解码器各有6层GTConv，每层包含：
- 深度可分离卷积（减少参数）
- 时间注意力模块（TRA）
- SE通道注意力
- 残差连接

用了不同的dilation rate [1,2,4,8,4,2] 来扩大感受野。

### DPGRNN（双路径GRU）

这是GTCRN的核心，有两个路径：

**Intra-path**：沿频率轴跑，双向GRU。处理频率维度的依赖关系，比如谐波结构。

**Inter-path**：沿时间轴跑。V1/V2是双向（离线），V3是单向（实时）。处理时间维度的依赖关系。

两个DPGRNN模块串联，增强时序建模能力。

### 输出层

输出是Complex Ratio Mask（复数比值掩码），同时处理幅度和相位。

## 三个版本

| 版本 | 特点 | 参数量 | DNSMOS |
|------|------|--------|--------|
| V1 | 离线处理，效果最好 | 139K | 3.147 |
| V2 | 加了瞬态感知损失 | 139K | 3.147 |
| V3 | 实时流式，10ms延迟 | 145K | 2.983 |

V1是baseline，V2针对键盘敲击这类突发噪声做了优化（改损失函数，不改架构），V3改成因果模型可以实时跑。

## V3的因果化改造

实时处理不能看未来帧，主要改了三个地方：

1. **卷积padding**：从对称padding改成只在左边填充
2. **TRA模块**：改成因果卷积
3. **Inter-path GRU**：从双向改成单向

Intra-path（沿频率轴）还是双向的，因为频率轴不涉及时间因果性。

因果化的代价是DNSMOS从3.147掉到2.983（约5%），但换来了10ms延迟和实时能力。

## 流式推理的状态管理

V3做流式推理需要维护帧间状态：
- GTConv的历史帧缓存（12层，不同dilation）
- TRA的历史均值
- GRU的hidden state
- 编码器到解码器的skip connection

## 什么时候用哪个版本

| 场景 | 推荐 | 原因 |
|------|------|------|
| 播客后期、视频配音 | V1 | 质量最好，不在乎延迟 |
| 办公环境录音 | V2 | 键盘鼠标噪声处理更好 |
| 实时通话、直播 | V3 | 必须低延迟 |
